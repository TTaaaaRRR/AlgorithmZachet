
## Блок 1: Основы BI и визуализации данных

### 1. Что такое BI и зачем он нужен бизнесу?

**BI (Business Intelligence)**, или Бизнес-аналитика, это совокупность инструментов, технологий и процессов для сбора, хранения, анализа и представления данных, которые помогают принимать более обоснованные бизнес-решения.

**Зачем он нужен бизнесу?**

* **Улучшение принятия решений:** BI предоставляет руководству и сотрудникам точную и своевременную информацию, необходимую для принятия стратегических, тактических и операционных решений. Например, вместо того чтобы гадать, почему продажи упали, BI-система покажет, что это произошло в конкретном регионе из-за отсутствия популярного товара.
* **Выявление тенденций и закономерностей:** BI помогает обнаруживать скрытые паттерны в данных, которые могут быть незаметны при обычном просмотре. Например, система может выявить, что клиенты, покупающие продукт А, часто покупают и продукт Б.
* **Мониторинг производительности:** Позволяет отслеживать ключевые показатели эффективности (KPI) и сравнивать их с целями. Например, отслеживать ежедневные продажи по регионам и сравнивать их с планом.
* **Оптимизация операций:** Помогает выявить неэффективные процессы и узкие места. Например, анализировать время доставки товаров и найти причины задержек.
* **Повышение конкурентоспособности:** Компании, использующие BI, могут быстрее реагировать на изменения рынка и предвидеть потребности клиентов.

**Пример:** Розничная сеть хочет понять, почему продажи в прошлом месяце были ниже ожидаемых. Без BI они могут тратить недели на ручной сбор и анализ данных из разных источников. С BI они могут получить интерактивную панель (дашборд), которая показывает продажи по продуктам, магазинам, регионам и даже по времени суток, выявляя, что продажи упали в конкретных магазинах из-за проблем с поставками.

### 2. Что такое DWH?

**DWH (Data Warehouse)**, или Хранилище Данных, это централизованное, интегрированное, ориентированное на предметную область, неперезаписываемое и зависящее от времени хранилище данных, предназначенное для поддержки процессов принятия решений.

**Ключевые характеристики DWH:**

* **Ориентированность на предметную область (Subject-Oriented):** Данные организованы вокруг основных бизнес-процессов (например, клиенты, продукты, продажи), а не вокруг конкретных приложений.
* **Интегрированность (Integrated):** Данные из различных источников (CRM, ERP, веб-сайты и т.д.) унифицируются и очищаются перед загрузкой в DWH. Это решает проблемы несовместимости форматов и типов данных.
* **Зависимость от времени (Time-Variant):** Данные в DWH содержат историческую информацию и метки времени, что позволяет анализировать тенденции и изменения с течением времени.
* **Неперезаписываемость (Non-volatile):** После загрузки в DWH данные остаются неизменными. Они не удаляются и не обновляются в обычном смысле, а добавляются новые записи, отражающие изменения.

**Зачем нужен DWH?**

Операционные системы (OLTP) оптимизированы для быстрой записи и обновления транзакций. Они не подходят для аналитических запросов, которые могут быть сложными и требовать больших объемов данных. DWH, наоборот, оптимизирован для чтения и анализа больших объемов исторических данных, что делает его идеальной основой для BI.

**Пример:** Крупный онлайн-магазин имеет разные системы для обработки заказов, управления запасами, маркетинговых кампаний. Каждая система хранит свои данные. Для анализа общей эффективности компании все эти данные должны быть объединены. DWH собирает данные из всех этих систем, очищает их, стандартизирует и хранит в едином формате, готовом для анализа.

### 3. Этапы разработки дашборда

Разработка дашборда — это итеративный процесс, который обычно включает следующие этапы:

1.  **Определение целей и аудитории (Discovery & Planning):**
    * **Цель:** Зачем нужен дашборд? Какие вопросы он должен отвечать? (Например, "Отслеживать ежедневные продажи", "Анализировать эффективность маркетинговых кампаний").
    * **Аудитория:** Кто будет использовать дашборд? Какие у них потребности? Какой уровень детализации им нужен? (Например, топ-менеджеры нуждаются в агрегированных показателях, аналитики — в более детальных данных).
    * **KPI (Key Performance Indicators):** Какие метрики важны для отслеживания?

    **Пример:** Руководитель отдела продаж хочет дашборд для отслеживания ежемесячных продаж. Цель - выявить отстающие регионы и продукты. Аудитория - менеджеры по продажам и руководитель. KPI: объем продаж, средний чек, количество новых клиентов.

2.  **Сбор и подготовка данных (Data Collection & Preparation):**
    * **Идентификация источников данных:** Где находятся нужные данные? (Базы данных, Excel-файлы, веб-сервисы и т.д.).
    * **Извлечение, преобразование, загрузка (ETL/ELT):** Данные извлекаются из источников, очищаются, преобразуются в нужный формат и загружаются в хранилище (чаще всего DWH или Data Lake).
    * **Моделирование данных:** Создание связей между таблицами, определение иерархий.

    **Пример:** Данные о продажах хранятся в базе данных CRM, данные о товарах — в ERP-системе. Их нужно объединить, очистить от дубликатов, привести к единому формату.

3.  **Выбор визуализаций и макета (Visualization Selection & Layout Design):**
    * **Выбор подходящих типов графиков:** В зависимости от типа данных и цели (гистограммы для сравнения, линейные графики для тенденций, круговые диаграммы для долей).
    * **Создание макета:** Определение расположения элементов на дашборде. Важно обеспечить логичный поток информации и избегать перегрузки.
    * **Принципы дизайна:** Использование цвета, шрифтов, отступов для улучшения читаемости.

    **Пример:** Для отслеживания продаж по месяцам — линейный график, для сравнения продаж по регионам — столбчатая диаграмма, для распределения продаж по категориям товаров — круговая диаграмма.

4.  **Разработка и тестирование (Development & Testing):**
    * **Построение дашборда:** Использование BI-инструмента (Power BI, Tableau, Qlik Sense) для создания визуализаций и интерактивных элементов.
    * **Тестирование:** Проверка корректности данных, функциональности фильтров и интерактивных элементов. Получение обратной связи от пользователей.

    **Пример:** Дашборд создается в Power BI. Тестируется, что фильтрация по дате работает корректно, и данные на графиках соответствуют данным в исходной системе.

5.  **Развертывание и поддержка (Deployment & Maintenance):**
    * **Публикация дашборда:** Размещение дашборда на сервере или в облаке, чтобы пользователи могли к нему получить доступ.
    * **Обучение пользователей:** Проведение тренингов для тех, кто будет использовать дашборд.
    * **Мониторинг и обновление:** Отслеживание производительности дашборда, внесение изменений и обновлений по мере необходимости.

    **Пример:** Дашборд публикуется в Power BI Service, предоставляется доступ менеджерам. Проводится обучение, как пользоваться фильтрами и проваливаться в детали. Дашборд регулярно обновляется новыми данными.

### 4. RLS/OLS

RLS и OLS — это механизмы безопасности в BI-системах, особенно актуальные для Power BI.

* **RLS (Row-Level Security) — Безопасность на уровне строк:**
    * Позволяет контролировать доступ пользователей к **строкам** данных в модели.
    * Это означает, что разные пользователи могут видеть разные подмножества данных в одной и той же таблице, в зависимости от их роли или атрибутов.
    * RLS реализуется путем создания ролей и применения DAX-выражений (Data Analysis Expressions), которые фильтруют данные.

    **Пример:**
    * Есть дашборд с продажами по регионам.
    * Менеджер по продажам региона "Север" должен видеть только данные по своему региону.
    * Менеджер по продажам региона "Юг" должен видеть только данные по своему региону.
    * Руководитель отдела продаж должен видеть данные по всем регионам.
    * RLS позволяет настроить это: для роли "Менеджер Севера" применяется фильтр `[Region] = "Север"`, для роли "Менеджер Юга" — `[Region] = "Юг"`, а для "Руководителя" — без фильтра.

* **OLS (Object-Level Security) — Безопасность на уровне объектов:**
    * Позволяет контролировать доступ пользователей к **объектам** в модели данных, таким как таблицы или столбцы.
    * Это означает, что определенные пользователи могут вообще не видеть определенные таблицы или столбцы данных, независимо от их значений.

    **Пример:**
    * В таблице "Сотрудники" есть столбец "Заработная плата".
    * OLS позволяет настроить, что только менеджеры по персоналу могут видеть этот столбец, а остальные пользователи — нет.
    * Даже если дашборд использует данные из этого столбца, для пользователей без соответствующих прав он будет отображаться как ошибка или пропущенное значение.

**Разница:**
* **RLS:** Фильтрует *строки* данных, при этом столбцы остаются видимыми. Пользователь видит "меньше данных".
* **OLS:** Скрывает *столбцы или таблицы* целиком. Пользователь видит "меньше объектов".

### 5. Типы отчётов

В контексте BI и визуализации данных можно выделить несколько основных типов отчётов:

1.  **Операционные отчёты (Operational Reports):**
    * **Назначение:** Предназначены для повседневного мониторинга текущих операций. Отвечают на вопросы "Что происходит сейчас?".
    * **Частота обновления:** Очень высокая (часто в реальном времени или близко к нему).
    * **Детализация:** Высокая детализация, показывают конкретные транзакции.
    * **Пример:** Отчёт о текущих заказах, отчёт о движении денежных средств за сегодня, отчёт о загрузке производственной линии в данный момент.

2.  **Аналитические отчёты (Analytical Reports):**
    * **Назначение:** Используются для глубокого анализа данных, выявления тенденций, паттернов и причинно-следственных связей. Отвечают на вопросы "Почему это произошло?" или "Что может произойти?".
    * **Частота обновления:** Периодическая (ежедневно, еженедельно, ежемесячно), поскольку данные требуют обработки и агрегации.
    * **Детализация:** Может варьироваться от высокоагрегированной до детализированной, с возможностью "проваливаться" (drill-down) в подробности.
    * **Пример:** Отчёт об эффективности маркетинговых кампаний за квартал, анализ оттока клиентов за год, прогноз продаж на следующий месяц. Часто используются в дашбордах.

3.  **Дашборды (Dashboards):**
    * **Назначение:** Интерактивные визуальные сводки ключевых показателей эффективности (KPI) и метрик, представленные на одном экране. Дают быстрый обзор состояния бизнеса.
    * **Частота обновления:** Может быть разной, но обычно регулярно обновляется.
    * **Детализация:** Высокоагрегированная информация, но с возможностью интерактивного детализации.
    * **Пример:** Дашборд продаж с показателями по выручке, марже, количеству заказов; дашборд HR с показателями по текучести кадров, найму.

4.  **Сводные отчёты / OLAP-отчёты (Summary Reports / OLAP Reports):**
    * **Назначение:** Представляют данные в многомерном виде, позволяя пользователям "нарезать и дробить" (slice and dice) данные по различным измерениям (время, продукт, регион и т.д.).
    * **Основа:** Чаще всего строятся на базе OLAP-кубов.
    * **Пример:** Анализ продаж по продуктам за последний год, с возможностью детализации до продаж по месяцам, по конкретным магазинам и по типу клиента.

### 6. Self-Service BI

**Self-Service BI** (Self-Service Business Intelligence) — это подход, который позволяет бизнес-пользователям (не техническим специалистам) самостоятельно получать доступ к данным, анализировать их, создавать отчёты и дашборды, без или с минимальным участием IT-отдела.

**Преимущества Self-Service BI:**

* **Скорость:** Бизнес-пользователи могут быстрее получать нужную информацию и принимать решения, не ожидая IT-отдела.
* **Гибкость:** Пользователи могут адаптировать отчёты под свои специфические нужды.
* **Снижение нагрузки на IT:** IT-отдел может сосредоточиться на более сложных задачах, таких как управление инфраструктурой и безопасностью данных.
* **Увеличение вовлеченности пользователей:** Пользователи чувствуют себя более empowered и активно используют данные.

**Пример:**
* **Традиционный подход:** Маркетолог хочет получить отчёт о клиентах, которые купили определенный продукт за последние 3 месяца. Он отправляет запрос в IT-отдел, IT-отдел пишет SQL-запрос, генерирует отчёт и отправляет его маркетологу. Это может занять несколько дней.
* **Self-Service BI:** Маркетолог использует Power BI (или аналогичный инструмент), где уже настроены связи с данными о продажах и клиентах. Он сам перетаскивает нужные поля, применяет фильтры по дате и продукту, и мгновенно получает нужный отчёт, а также может создать на его основе интерактивный дашборд.

**Риски и вызовы:**
* **Качество данных:** Если пользователи не понимают источник данных или их ограничения, могут быть сделаны неверные выводы.
* **Отсутствие стандартизации:** Разные пользователи могут создавать разные отчёты для одних и тех же показателей, что приводит к расхождениям.
* **Безопасность данных:** Неконтролируемый доступ может привести к утечке конфиденциальной информации.
* **Необходимость обучения:** Несмотря на простоту, пользователи все равно нуждаются в базовом обучении работе с инструментами и пониманию данных.

Для успешного внедрения Self-Service BI необходимо обеспечить качественные и стандартизированные данные, а также обучить пользователей.

### 7. Модели данных в BI

Модель данных в BI — это структурированное представление данных, которое определяет, как данные организованы, как они связаны друг с другом и как они могут быть запрошены и проанализированы. Она служит основой для построения отчётов и дашбордов.

Основные типы моделей данных, используемых в BI:

1.  **Звёздная схема (Star Schema):**
    * **Структура:** Состоит из одной центральной **таблицы фактов (Fact Table)**, окруженной несколькими **таблицами измерений (Dimension Tables)**.
    * **Таблица фактов:** Содержит количественные данные (метрики, меры) и внешние ключи, связывающие ее с таблицами измерений.
    * **Таблицы измерений:** Содержат описательные атрибуты, по которым можно анализировать данные (например, "Дата", "Продукт", "Клиент", "География").
    * **Связи:** Таблица фактов напрямую связана с каждой таблицей измерений.
    * **Преимущества:** Простота понимания и реализации, высокая производительность при запросах (меньше join-операций).
    * **Недостатки:** Возможна избыточность данных в таблицах измерений, если они содержат иерархии (например, Год -> Месяц -> День).

    **Пример:**
    * **Таблица фактов (Продажи):** `[ID Продажи], [ID Даты], [ID Продукта], [ID Клиента], [Количество], [Цена], [Скидка]`
    * **Таблица измерений (Дата):** `[ID Даты], [Дата], [Год], [Месяц], [День Недели]`
    * **Таблица измерений (Продукт):** `[ID Продукта], [Название Продукта], [Категория], [Бренд]`
    * **Таблица измерений (Клиент):** `[ID Клиента], [Имя Клиента], [Город], [Страна]`

2.  **Снежинка (Snowflake Schema):**
    * **Структура:** Расширение звёздной схемы, где таблицы измерений **нормализованы**. Это означает, что таблицы измерений могут быть связаны с другими таблицами измерений (под-измерениями).
    * **Преимущества:** Меньшая избыточность данных, более эффективное хранение.
    * **Недостатки:** Более сложные запросы (больше join-операций), что может снизить производительность.

    **Пример:**
    * **Таблица фактов (Продажи):** `[ID Продажи], [ID Даты], [ID Продукта], [ID Магазина], [Количество], [Цена]`
    * **Таблица измерений (Продукт):** `[ID Продукта], [Название Продукта], [ID Категории]`
        * **Таблица измерений (Категория):** `[ID Категории], [Название Категории]` (связана с Продуктом)
    * **Таблица измерений (Магазин):** `[ID Магазина], [Название Магазина], [ID Города]`
        * **Таблица измерений (Город):** `[ID Города], [Название Города], [ID Страны]` (связана с Магазином)
        * **Таблица измерений (Страна):** `[ID Страны], [Название Страны]` (связана с Городом)

**Почему эти модели важны в BI?**

* **Производительность:** Оптимизация для быстрых аналитических запросов.
* **Простота использования:** Упрощает для бизнес-пользователей создание отчётов, поскольку логика связей уже определена.
* **Качество данных:** Обеспечивает согласованность и целостность данных.
* **Масштабируемость:** Позволяет добавлять новые данные и измерения без значительного перепроектирования.

### 8. Компоненты Power BI

Power BI — это комплексное решение от Microsoft для бизнес-аналитики, которое состоит из нескольких ключевых компонентов:

1.  **Power BI Desktop:**
    * **Назначение:** Бесплатное приложение для Windows, основное средство для разработки отчётов и дашбордов.
    * **Функциональность:**
        * **Подключение к данным:** Подключение к сотням различных источников данных (Excel, базы данных, веб-сервисы и т.д.).
        * **Преобразование данных (Power Query):** Инструмент для очистки, трансформации и объединения данных (ETL).
        * **Моделирование данных:** Создание связей между таблицами, создание вычисляемых столбцов и мер (DAX).
        * **Создание визуализаций:** Построение графиков, таблиц и других элементов дашборда.
        * **Публикация:** Публикация отчётов в Power BI Service.

2.  **Power BI Service (Power BI Online/Web):**
    * **Назначение:** Облачная платформа (SaaS) для публикации, совместного использования и распространения отчётов и дашбордов.
    * **Функциональность:**
        * **Публикация:** Отчёты, созданные в Desktop, публикуются сюда.
        * **Совместное использование:** Распространение отчётов и дашбордов среди пользователей внутри организации.
        * **Управление доступом:** Настройка RLS/OLS и других уровней безопасности.
        * **Обновление данных:** Настройка автоматического обновления данных из источников.
        * **Создание дашбордов:** Возможность создавать интерактивные дашборды из различных отчётов (закрепляя визуализации).
        * **Рабочие области (Workspaces):** Организация контента для команд или проектов.
        * **Приложения (Apps):** Коллекции отчётов и дашбордов, которые можно распространять среди большого числа пользователей.

3.  **Power BI Mobile Apps:**
    * **Назначение:** Мобильные приложения для iOS, Android и Windows для просмотра отчётов и дашбордов на смартфонах и планшетах.
    * **Функциональность:** Просмотр интерактивных отчётов, получение уведомлений, возможность комментировать.

4.  **Power BI Report Server (опционально):**
    * **Назначение:** Локальный сервер для организаций, которым требуется хранить данные и отчёты внутри своей инфраструктуры (on-premise) по соображениям безопасности или нормативным требованиям.
    * **Функциональность:** Аналогична Power BI Service, но развернута локально.

5.  **Power BI Gateway (шлюз):**
    * **Назначение:** Программное обеспечение, устанавливаемое на локальный сервер, которое обеспечивает безопасное подключение Power BI Service (облака) к локальным источникам данных (базы данных, Excel-файлы на сервере и т.д.).
    * **Функциональность:** Позволяет Power BI Service обновлять данные, которые хранятся за корпоративным файрволом.

**Схема работы:**
1.  **Разработка:** Аналитик использует **Power BI Desktop** для подключения к источникам данных, их преобразования, построения модели данных, создания мер и визуализаций.
2.  **Публикация:** Созданный отчёт публикуется в **Power BI Service**.
3.  **Доступ:** Пользователи получают доступ к отчёту через **Power BI Service** (в браузере) или через **Power BI Mobile Apps**. Если данные находятся локально, **Power BI Gateway** обеспечивает их обновление.
4.  **Совместное использование:** В Power BI Service можно создавать дашборды, делиться ими, настраивать роли безопасности.

### 9. Режимы работы с данными в BI-системах (на примере Power BI)

В BI-системах, особенно в Power BI, существуют различные режимы подключения к данным, которые влияют на производительность, актуальность данных и возможности моделирования.

1.  **Import Mode (Импорт):**
    * **Принцип:** Данные **полностью загружаются и хранятся** в модели данных Power BI (в памяти).
    * **Преимущества:**
        * **Высокая производительность:** Запросы выполняются очень быстро, так как данные находятся в памяти.
        * **Полная функциональность DAX:** Доступны все возможности DAX для создания сложных вычислений и мер.
        * **Нет зависимости от исходного источника:** После импорта данные доступны, даже если источник недоступен.
    * **Недостатки:**
        * **Ограничение по объему данных:** Модель ограничена объемом доступной памяти или лицензии (до 10 ГБ на модель для Power BI Pro, больше для Premium).
        * **Неактуальность:** Данные обновляются только при ручном или запланированном обновлении.
    * **Когда использовать:** Для большинства сценариев, когда объем данных не слишком велик и не требуется анализ в реальном времени.

2.  **DirectQuery Mode:**
    * **Принцип:** Данные **не загружаются** в модель Power BI. Вместо этого, каждый раз, когда пользователь взаимодействует с отчётом (фильтрует, нажимает), Power BI генерирует и отправляет **SQL-запрос напрямую к исходному источнику данных** (базе данных).
    * **Преимущества:**
        * **Актуальность данных:** Всегда самые актуальные данные, так как запросы идут напрямую к источнику.
        * **Нет ограничений по объему данных:** Может работать с очень большими объемами данных, так как они не хранятся в Power BI.
    * **Недостатки:**
        * **Производительность:** Медленнее, чем Import, так как каждый запрос требует обращения к источнику. Производительность зависит от источника.
        * **Ограничения DAX:** Некоторые функции DAX недоступны, так как они не могут быть преобразованы в SQL-запросы.
        * **Зависимость от источника:** Исходный источник данных должен быть всегда доступен и производителен.
        * **Нагрузка на источник:** Может создавать большую нагрузку на исходную базу данных.
    * **Когда использовать:** Для очень больших наборов данных, где актуальность данных критична (например, операционные дашборды), и когда нет возможности импортировать весь объем.

3.  **Live Connection (Прямое подключение):**
    * **Принцип:** Используется для подключения к уже существующим моделям данных, таким как **SQL Server Analysis Services (SSAS) Tabular/Multidimensional** или **Power BI Datasets** в Power BI Service. Power BI Desktop выступает как клиент, который отправляет запросы к этой модели.
    * **Преимущества:**
        * **Централизованная модель:** Используется единая, заранее построенная и оптимизированная модель данных.
        * **Высокая производительность:** Зависит от производительности сервера SSAS/Power BI Dataset.
        * **Актуальность:** Данные обновляются в источнике (SSAS/Power BI Service).
    * **Недостатки:**
        * **Нет Power Query:** Нельзя выполнять преобразования данных в Power BI Desktop.
        * **Ограничения DAX:** Нельзя создавать новые вычисляемые столбцы или меры в Power BI Desktop (только использовать те, что уже есть в модели).
        * **Зависимость от источника:** Требует наличия и доступности источника.
    * **Когда использовать:** Когда у вас уже есть корпоративное хранилище данных или модель SSAS, и вы хотите использовать ее как единый источник истины.

4.  **Composite Models (Составные модели) / Mixed Mode:**
    * **Принцип:** Позволяет комбинировать Import Mode и DirectQuery Mode в одной модели данных. Часть данных может быть импортирована, а другая часть (например, очень большие таблицы или данные, требующие высокой актуальности) может использовать DirectQuery.
    * **Преимущества:** Сочетает преимущества обоих режимов, позволяя оптимизировать производительность и актуальность для разных частей данных.
    * **Недостатки:** Сложность в разработке и управлении, нужно хорошо понимать, какие таблицы в каком режиме находятся и как это влияет на запросы.
    * **Когда использовать:** Для сложных сценариев, где требуется гибкость в работе с данными разного объема и актуальности.

### 10. Основные визуализации и как их лучше использовать

Выбор правильной визуализации критически важен для эффективной передачи информации. Вот основные типы и рекомендации по их использованию:

1.  **Гистограмма / Столбчатая диаграмма (Bar Chart / Column Chart):**
    * **Назначение:** Сравнение категориальных данных или изменение значений со временем.
    * **Использование:**
        * **Столбчатая (вертикальная):** Для сравнения значений по разным категориям (например, продажи по месяцам, выручка по регионам, количество клиентов по городам).
        * **Гистограмма (горизонтальная):** Удобна, когда названия категорий длинные, или категорий много.
    * **Пример:** Продажи каждого продукта за квартал.

2.  **Линейный график (Line Chart):**
    * **Назначение:** Показать тенденции и изменения данных с течением времени.
    * **Использование:** Отслеживание продаж по дням/месяцам, изменение температуры, курса валют. Не используйте для сравнения категорий, не имеющих временной зависимости.
    * **Пример:** Динамика посещаемости веб-сайта за последний год.

3.  **Круговая диаграмма / Кольцевая диаграмма (Pie Chart / Donut Chart):**
    * **Назначение:** Показать доли целого (проценты).
    * **Использование:** Только для небольшого числа категорий (обычно не более 5-7), когда сумма всех частей составляет 100%. Избегайте, когда части очень похожи по размеру, так как трудно сравнивать углы.
    * **Пример:** Доля каждого типа товара в общем объеме продаж.

4.  **Точечная диаграмма (Scatter Plot):**
    * **Назначение:** Показать взаимосвязь (корреляцию) между двумя числовыми переменными.
    * **Использование:** Выявление паттернов, кластеров, аномалий. Может включать третью переменную через размер или цвет точек.
    * **Пример:** Зависимость рекламных расходов от объема продаж.

5.  **Пузырьковая диаграмма (Bubble Chart):**
    * **Назначение:** Точечная диаграмма с добавлением третьей числовой переменной, которая отображается размером "пузырька".
    * **Использование:** Анализ зависимости между тремя переменными.
    * **Пример:** Продажи (ось X), Маржа (ось Y), Количество транзакций (размер пузырька) для каждого продукта.

6.  **Карта (Map):**
    * **Назначение:** Визуализация географических данных.
    * **Использование:** Отображение продаж по регионам, плотности населения, расположения магазинов. Различные типы карт (заливка, пузырьки) в зависимости от задачи.
    * **Пример:** Распределение клиентов по странам.

7.  **Древовидная карта (Treemap):**
    * **Назначение:** Иерархическое представление данных, где размер прямоугольника пропорционален значению, а цвет может показывать другую метрику.
    * **Использование:** Когда нужно показать части целого в иерархическом порядке.
    * **Пример:** Продажи по категориям продуктов, а внутри категорий — по подкатегориям.

8.  **Воронка (Funnel Chart):**
    * **Назначение:** Визуализация последовательных этапов процесса и отслеживание "отсева" на каждом этапе.
    * **Использование:** Для анализа воронки продаж, процесса найма, конверсии пользователей на сайте.
    * **Пример:** Количество посетителей сайта -> количество зарегистрированных -> количество добавивших товар в корзину -> количество совершивших покупку.

9.  **Таблица / Матрица (Table / Matrix):**
    * **Назначение:** Отображение точных значений данных, сравнение большого количества категорий.
    * **Использование:** Когда точные числа важнее визуального представления. Матрица позволяет показывать данные в виде сводной таблицы с несколькими уровнями строк и столбцов.
    * **Пример:** Детальный отчёт по продажам с указанием каждого продукта, цены и количества.

10. **Карточки / KPI-индикаторы (Cards / KPI Indicators):**
    * **Назначение:** Выделение одного или нескольких ключевых показателей (KPI) для быстрого обзора.
    * **Использование:** Отображение текущего значения, цели и отклонения.
    * **Пример:** Общая выручка за текущий месяц, количество новых клиентов, средний чек.

**Общие принципы выбора:**

* **Цель:** Что вы хотите донести? Сравнение, тенденция, доля, распределение, взаимосвязь?
* **Тип данных:** Категориальные, числовые, временные, географические?
* **Аудитория:** Насколько знакомы пользователи с визуализациями? Нужна ли высокая детализация?
* **Простота:** Чем проще и понятнее визуализация, тем лучше. Избегайте чрезмерной сложности.

### 11. Что такое метрики и измерения, чем отличаются

В контексте BI и анализа данных, **метрики** и **измерения** (или факты и измерения) — это фундаментальные понятия, которые определяют структуру аналитических данных.

1.  **Измерения (Dimensions):**
    * **Определение:** Это качественные, описательные атрибуты, которые используются для классификации, группировки и фильтрации данных. Они отвечают на вопросы "Кто?", "Что?", "Где?", "Когда?".
    * **Характеристики:**
        * Содержат категориальные или временные значения.
        * Представляют собой контекст для метрик.
        * Часто являются столбцами в таблицах измерений (в звездной схеме).
    * **Примеры:**
        * **Время:** Год, Квартал, Месяц, День, Час.
        * **География:** Страна, Регион, Город, Магазин.
        * **Продукт:** Название продукта, Категория продукта, Бренд.
        * **Клиент:** Имя клиента, Возраст, Пол, Сегмент клиента.
        * **Сотрудник:** Имя сотрудника, Отдел, Должность.

2.  **Метрики (Metrics) / Меры (Measures) / Факты (Facts):**
    * **Определение:** Это количественные, числовые значения, которые можно агрегировать (суммировать, усреднять, считать). Они отвечают на вопросы "Сколько?", "Как много?", "Каково значение?".
    * **Характеристики:**
        * Всегда числовые.
        * Могут быть агрегированы (SUM, AVG, COUNT, MIN, MAX и т.д.).
        * Являются тем, что вы измеряете.
        * Часто являются столбцами в таблицах фактов (в звездной схеме) или вычисляются на их основе.
    * **Примеры:**
        * **Продажи:** Сумма продаж, Количество проданных единиц, Средний чек.
        * **Финансы:** Прибыль, Расходы, Маржа.
        * **Производство:** Количество произведенных единиц, Время простоя.
        * **Веб-аналитика:** Количество посещений, Количество уникальных пользователей, Время на сайте.

**Ключевое отличие:**

* **Измерения** - это **контекст**, по которому вы смотрите на данные. Они позволяют "разрезать" и "посмотреть" данные под разными углами.
* **Метрики** - это **значения**, которые вы измеряете в этом контексте.

**Пример:**

Представьте, что у вас есть данные о продажах.

* **Продажи по месяцам:**
    * **Месяц** - это **измерение** (контекст времени).
    * **Количество проданных товаров** или **Сумма выручки** - это **метрика**.

* **Средний чек по регионам:**
    * **Регион** - это **измерение** (контекст географии).
    * **Средний чек** (вычисляемая метрика: Сумма продаж / Количество транзакций) - это **метрика**.

**Почему это важно в BI?**

* **Структура данных:** Модели данных в BI (например, звездная схема) строятся на основе этого разделения.
* **Аналитические запросы:** Пользователи выбирают измерения, по которым они хотят анализировать (например, "показать продажи по продукту и по региону"), а затем выбирают метрики, которые они хотят видеть (например, "сумму продаж" или "количество").
* **Визуализация:** Измерения обычно используются для осей (X или Y), легенд или фильтров, а метрики — для значений, отображаемых на графиках (высота столбцов, размер пузырьков).

Отлично, переходим ко второму блоку вопросов, посвященному Apache Superset!

---

## Блок 2: Apache Superset

Apache Superset — это современное, высокомасштабируемое, облачно-ориентированное BI-приложение, которое позволяет исследовать данные, создавать дашборды и визуализации.

### 1. Основные вкладки Superset

Когда вы входите в Apache Superset, вы обычно видите несколько ключевых вкладок или разделов в верхней части интерфейса, которые обеспечивают навигацию по основным функциям. Хотя точные названия и расположение могут немного меняться между версиями, основные концепции остаются:

1.  **Home / Главная (иногда просто логотип Superset или иконка домика):**
    * Возвращает на домашнюю страницу, которая обычно представляет собой обзор ваших недавно открытых дашбордов и чартов, а также может содержать ссылки на быстрые действия.

2.  **Dashboards / Дашборды:**
    * Это основное место, где хранятся и отображаются все созданные дашборды.
    * Здесь вы можете просматривать, редактировать, делиться, искать и удалять дашборды.
    * Есть возможность создания нового дашборда.
    * Дашборды — это интерактивные страницы, на которых скомпонованы различные чарты (визуализации) для представления всеобъемлющего обзора данных.

3.  **Charts / Charts (Explore) / Чарты / Диаграммы:**
    * Этот раздел содержит все отдельные визуализации (чарты), которые были созданы.
    * Здесь вы можете просматривать, редактировать, создавать новые чарты (переходить в режим "Explore"), добавлять их на дашборды, делиться и удалять.
    * Каждый чарт — это самостоятельная визуализация, которая может быть использована как строительный блок для дашборда.

4.  **SQL Lab:**
    * Мощный инструмент для непосредственного взаимодействия с базами данных, подключенными к Superset.
    * Позволяет писать, выполнять и сохранять SQL-запросы.
    * Результаты запросов можно просматривать, сохранять как CSV или превращать в новые датасеты для дальнейшего анализа.
    * Это особенно полезно для дата-инженеров и аналитиков, которым нужен детальный контроль над данными.

5.  **Data / Данные:**
    * **Databases / Базы данных:** Управление подключениями к источникам данных (PostgreSQL, MySQL, ClickHouse, BigQuery и т.д.). Здесь вы добавляете новые базы данных и настраиваете их параметры подключения.
    * **Datasets / Датасеты:** Управление логическими представлениями данных (виртуальными таблицами), на основе которых строятся чарты. Это один из важнейших разделов, так как именно датасеты являются мостом между сырыми данными в БД и визуализациями. Здесь вы можете создавать новые датасеты, редактировать существующие, синхронизировать метаданные.
    * (Иногда может быть подраздел `Saved Queries` из SQL Lab)

6.  **Security / Безопасность (иногда под `Settings` или `Admin`):**
    * **Users / Пользователи:** Управление пользователями системы.
    * **Roles / Роли:** Настройка ролей и разрешений для пользователей. Очень важно для RLS/OLS.
    * **Permissions / Разрешения:** Детальная настройка прав доступа к базам данных, датасетам, дашбордам и другим функциям.

7.  **Settings / Настройки (иногда иконка шестеренки или под именем пользователя):**
    * Может содержать общие настройки Superset, список подключенных плагинов, информацию о системе.
    * (Иногда включает разделы `Databases`, `Datasets`, `Roles` и `Users`, если они не вынесены в отдельную вкладку `Data` или `Security`).

Эти вкладки обеспечивают полный жизненный цикл работы с данными в Superset: от подключения к источнику, определения датасета, создания визуализаций до их сборки в интерактивные дашборды и управления доступом.

### 2. Окно редактирования чарта (Explore View)

Окно редактирования чарта в Superset, часто называемое **"Explore View"** (или просто "Chart Editor"), является центральным местом для создания и настройки визуализаций. Оно обычно делится на несколько основных секций:

1.  **Панель инструментов (Top Bar):**
    * **Название чарта:** Позволяет задать или изменить название чарта.
    * **Кнопки действия:** "Save" (Сохранить), "Save as" (Сохранить как), "Add to Dashboard" (Добавить на дашборд), "Share" (Поделиться), "Download" (Скачать данные/изображение).
    * **Refresh Chart / Run Query:** Кнопка для запуска запроса и обновления визуализации.

2.  **Панель настроек (Data & Customize Tabs / Left Panel):**
    * **DATA / ДАННЫЕ (или Query):** Эта вкладка, как правило, находится слева и является основной для определения, какие данные будут использоваться и как они будут агрегированы.
        * **Dataset / Датасет:** Выбор датасета, на основе которого будет строиться чарт.
        * **Visualization type / Тип визуализации:** Выбор типа графика (линейный, столбчатый, круговой и т.д.).
        * **Time / Время:** Настройки для временных данных:
            * **Time Column / Time Grain:** Выбор временного столбца и гранулярности (день, месяц, год).
            * **Time Range:** Фильтрация по временному диапазону (например, "last year", "this month").
        * **Group By / Группировка:** Выбор одного или нескольких измерений, по которым данные будут группироваться.
        * **Metrics / Метрики:** Выбор одной или нескольких мер, которые будут агрегироваться (например, SUM(продажи), COUNT(клиенты), AVG(цена)). Можно выбрать предопределенные метрики из датасета или создать свои.
        * **Filters / Фильтры:** Применение фильтров к данным (например, `Страна = "США"`). Могут быть применены на уровне запроса.
        * **Limit / Sort:** Настройка ограничений по количеству строк и сортировки.
        * **(Иногда) Columns:** Для табличных визуализаций, выбор столбцов для отображения.

    * **CUSTOMIZE / НАСТРОЙКА (или Chart Properties / Style):** Эта вкладка также обычно находится слева и позволяет настроить внешний вид визуализации. Доступные опции зависят от выбранного типа чарта.
        * **Цвет:** Настройка цветовой палитры.
        * **Заголовки и подписи осей:** Изменение названий осей X и Y.
        * **Легенда:** Положение и видимость легенды.
        * **Шрифты и размеры:** Настройка текста.
        * **Tooltip:** Что отображать при наведении на элемент графика.
        * **Отображение значений:** Включение/отключение меток данных.
        * **(Специфичные для графика) Bar chart specific options:** Например, stacked/grouped bars.
        * **(Специфичные для графика) Line chart specific options:** Например, show markers, area fill.

3.  **Область предпросмотра (Chart Preview Area / Right Panel):**
    * Большая часть экрана справа, где отображается ваша визуализация в реальном времени по мере изменения настроек.
    * При каждом изменении настроек в панели слева (или при нажатии "Run Query"), чарт обновляется, показывая результаты.

4.  **Просмотр данных / SQL запроса (Data / SQL tabs below the preview):**
    * Под областью предпросмотра часто находятся вкладки, позволяющие просмотреть:
        * **Data:** Табличное представление данных, которые используются для построения текущего чарта после всех агрегаций и фильтраций.
        * **SQL:** Генерируемый SQL-запрос, который Superset отправляет в базу данных для получения данных для чарта. Это очень полезно для отладки и понимания, как Superset взаимодействует с БД.

**Пример процесса создания чарта:**

1.  Выбираем датасет "Продажи".
2.  Выбираем тип визуализации "Столбчатая диаграмма".
3.  На вкладке "DATA":
    * В "Group By" выбираем "Месяц".
    * В "Metrics" выбираем "SUM(Выручка)".
    * В "Time Range" выбираем "Last 12 months".
4.  На вкладке "CUSTOMIZE":
    * Меняем название оси X на "Месяц продажи".
    * Меняем название оси Y на "Общая выручка".
5.  Нажимаем "Run Query" (или чарт обновляется автоматически), и видим столбчатую диаграмму, показывающую выручку по месяцам за последний год.
6.  Сохраняем чарт.

### 3. Типы датасетов

В Apache Superset "датасет" — это логическое представление данных, которое используется для создания чартов и дашбордов. Датасеты не являются самими сырыми таблицами в базе данных; это метаданные, которые описывают, как Superset должен интерпретировать и работать с этими данными.

Superset поддерживает несколько типов датасетов, или, точнее, способов их создания и использования:

1.  **Табличные датасеты (Table Datasets):**
    * **Описание:** Это самый распространенный тип. Датасет создается на основе существующей таблицы или представления (view) в подключенной базе данных.
    * Superset автоматически подтягивает метаданные (названия столбцов, типы данных) из этой таблицы/view.
    * Вы можете выбрать, какие столбцы будут использоваться как измерения, а какие как метрики, а также добавлять вычисляемые столбцы.
    * **Создание:** Через `Data -> Datasets -> + Dataset` и выбор базы данных и таблицы.
    * **Пример:** У вас есть таблица `sales` в базе данных. Вы создаете датасет "Продажи", который указывает на эту таблицу.

2.  **Датасеты из SQL-запроса / Виртуальные датасеты (SQL Query / Virtual Datasets):**
    * **Описание:** Позволяют создать датасет на основе произвольного SQL-запроса, написанного пользователем.
    * Это очень мощный инструмент, так как он позволяет:
        * Объединять данные из нескольких таблиц (JOIN).
        * Применять сложные фильтрации и агрегации прямо на уровне SQL.
        * Создавать сложные вычисляемые поля, которые не могут быть реализованы через стандартные функции Superset.
    * **Создание:** В `SQL Lab` вы пишете запрос, затем нажимаете `EXPLORE` или `SAVE AS DATASET`.
    * **Пример:** Вы хотите анализировать продажи, объединив данные о продажах с данными о клиентах и продуктах из разных таблиц. Вы пишете SQL-запрос с JOIN-ами и GROUP BY, сохраняете его как новый датасет "Сводные продажи".

3.  **"Просмотры" как датасеты (Views as Datasets):**
    * Это, по сути, подтип табличных датасетов. Если в вашей базе данных уже существуют "представления" (views), которые представляют собой сохраненные SQL-запросы, вы можете подключить их как обычные таблицы.
    * **Преимущество:** Логика SQL-запроса выполняется на стороне базы данных, а не Superset, что может быть более производительным и позволяет использовать специфические функции БД.
    * **Пример:** Ваш дата-инженер создал view `v_daily_sales` в БД, который уже агрегирует данные. Вы просто подключаете этот view как датасет.

**Важность датасетов:**

* **Абстракция:** Датасеты предоставляют слой абстракции между сырыми данными и пользователями. Бизнес-пользователям не нужно знать сложную структуру базы данных или писать SQL; они просто выбирают нужный датасет.
* **Метаданные:** Датасеты хранят метаданные (типы столбцов, агрегации, описания), которые Superset использует для корректной работы.
* **Безопасность:** RLS и OLS в Superset применяются именно на уровне датасетов.

### 4. Настройка датасета

После создания датасета в Superset (на основе таблицы или SQL-запроса) его необходимо настроить. Это критически важный шаг для обеспечения правильной работы визуализаций и анализа данных. Настройки датасета доступны через `Data -> Datasets`, выберите нужный датасет и нажмите "Edit record" (иконка карандаша).

Основные секции настройки датасета:

1.  **General (Общие):**
    * **Dataset Name:** Имя, под которым датасет будет отображаться в Superset. Должно быть понятным и информативным.
    * **SQL Table Name / SQL Query:** Отображает имя таблицы/представления или сам SQL-зазапрос, на котором основан датасет.
    * **Database:** База данных, к которой подключен датасет.
    * **Schema (схема):** Если база данных поддерживает схемы (например, PostgreSQL), здесь указывается схема таблицы.
    * **Description:** Описание датасета, которое помогает пользователям понять его назначение.

2.  **Columns (Столбцы):**
    * Здесь отображаются все столбцы из базовой таблицы/запроса. Для каждого столбца вы можете настроить:
        * **Type (Тип):** Superset пытается определить тип автоматически, но его можно изменить (например, `TEXT`, `NUMERIC`, `DATETIME`, `BOOLEAN`). Это влияет на то, как Superset обрабатывает данные.
        * **Is Dimension (Является измерением):** Флажок, который указывает, является ли столбец измерением (может использоваться для группировки, фильтрации, на осях). **Очень важно!** Столбцы, которые вы хотите использовать в Group By или на осях, должны быть помечены как измерения.
        * **Is Metric (Является метрикой):** Флажок, который указывает, является ли столбец метрикой (числовое значение, которое можно агрегировать).
        * **Count Distinct (Считать уникальные):** Флажок для метрик, позволяющий автоматически создавать метрику "количество уникальных значений".
        * **Expression (Выражение):** Для вычисляемых столбцов (SQL Alchemy expression). Позволяет создавать новые столбцы на основе существующих (например, `cost * quantity` для "Суммы продаж").
        * **Verbose Name (Подробное имя):** Более понятное название столбца для отображения в Superset (например, `total_sales` может стать `Общая Выручка`).
        * **Description:** Описание столбца.
        * **Is temporal (Временной):** Для столбцов с датой/временем, указывает, что это временное измерение.
        * **Granularity (Гранулярность):** Для временных столбцов, позволяет указать, как Superset может агрегировать время (например, `day`, `week`, `month`, `year`).

3.  **Metrics (Метрики):**
    * Эта секция позволяет создавать и управлять предопределенными метриками для датасета.
    * Вы можете добавить новую метрику, указав:
        * **Metric Name:** Имя метрики (например, `Total Sales`).
        * **Aggregate:** Тип агрегации (SUM, AVG, COUNT, MIN, MAX, COUNT_DISTINCT и т.д.).
        * **SQL Expression:** SQL-выражение для метрики (например, `sum(price * quantity)`).
        * **Description:** Описание.
        * **D3 Format:** Формат отображения числа (например, `$,.2f` для долларов с двумя знаками после запятой).
    * Предопределенные метрики очень удобны, так как пользователи могут просто выбрать их из списка при создании чарта, не заботясь о SQL-выражениях.

4.  **Calculated Columns (Вычисляемые столбцы):**
    * Позволяет создавать новые столбцы, используя SQL-выражения, которые не являются агрегациями (в отличие от метрик).
    * Например, `CASE WHEN age < 18 THEN 'Minor' ELSE 'Adult' END` для создания нового измерения "Возрастная группа".

5.  **SQL Lab (Секция внизу):**
    * Иногда внизу страницы редактирования датасета может быть ссылка или мини-SQL-редактор, позволяющий протестировать SQL-запрос датасета или быстро перейти в SQL Lab.

**Почему настройка датасета важна?**

* **Удобство использования:** Правильно настроенные измерения и метрики делают датасет интуитивно понятным для бизнес-пользователей.
* **Корректность расчетов:** Убедитесь, что метрики агрегируются правильно.
* **Производительность:** Оптимизация типов данных и индексов в базовой БД (хотя это уже за пределами Superset, но влияет на его работу).
* **Согласованность:** Обеспечивает, что все, кто использует этот датасет, видят одни и те же определения измерений и метрик.

### 5. Фильтрация в Superset

Superset предлагает мощные возможности для фильтрации данных на разных уровнях, позволяя пользователям сужать объем информации и фокусироваться на интересующих их аспектах.

Основные механизмы фильтрации:

1.  **Фильтры на уровне чарта (Chart-level Filters):**
    * **Где настраиваются:** В "Explore View" (окне редактирования чарта), в разделе "DATA" (обычно слева).
    * **Принцип:** Эти фильтры применяются к данным **до** их загрузки в чарт и до любых агрегаций. Они являются частью SQL-запроса, который Superset отправляет в базу данных.
    * **Применение:** Вы выбираете столбец, оператор (равно, не равно, больше, между и т.д.) и значение.
    * **Назначение:** Используются для создания чартов, которые по умолчанию показывают только определенное подмножество данных (например, "Продажи только по товарам категории 'Электроника'").
    * **Пример:** Создавая чарт "Продажи по месяцам", вы добавляете фильтр `Страна = "США"`, чтобы чарт всегда показывал только данные по США.

2.  **Фильтры на уровне дашборда (Dashboard Filters):**
    * **Где настраиваются:** На дашборде, добавляя специальные визуализации "Filter Box" (поле фильтра).
    * **Принцип:** Эти фильтры являются интерактивными элементами на дашборде, которые позволяют пользователям динамически изменять данные, отображаемые во всех (или выбранных) чартах на этом дашборде.
    * **Назначение:** Предоставить конечным пользователям возможность "нарезать и дробить" данные самостоятельно, без необходимости редактировать каждый чарт.
    * **Связывание фильтров с чартами:** Каждый фильтр на дашборде должен быть связан с конкретным столбцом (измерением) в одном или нескольких датасетах. Вы можете настроить, на какие чарты данный фильтр будет влиять.
    * **Типы фильтров:** Выпадающие списки, слайдеры дат, текстовые поля и т.д.
    * **Пример:** На дашборде "Обзор продаж" вы добавляете фильтр по "Региону". Когда пользователь выбирает "Север", все чарты на дашборде (общая выручка, продажи по продуктам, новые клиенты) автоматически обновляются, показывая данные только по Северному региону.

3.  **Фильтры по времени (Time Filters):**
    * **Где настраиваются:** На уровне чарта (в "Explore View") в разделе "TIME" и на дашборде через "Date Filter".
    * **Принцип:** Специализированные фильтры для временных измерений.
    * **Назначение:** Удобное и быстрое ограничение данных по временным диапазонам (например, "Last 30 days", "Current quarter", "Custom date range").
    * **Пример:** Выбрать "Yesterday" для просмотра вчерашних продаж.

4.  **RLS/OLS как механизм фильтрации/контроля доступа:**
    * Хотя RLS/OLS формально не являются "фильтрами" в смысле пользовательского выбора, они служат мощным механизмом **принудительной фильтрации данных на уровне строк или объектов** для обеспечения безопасности и конфиденциальности. Они рассматриваются как часть функционала безопасности, но по сути фильтруют данные для конкретных пользователей.

**Приоритет фильтров:**

Фильтры применяются последовательно:
1.  **RLS/OLS:** Применяются первыми, ограничивая данные, доступные пользователю.
2.  **Фильтры на уровне чарта:** Затем применяются к данным, уже отфильтрованным RLS/OLS.
3.  **Фильтры на уровне дашборда:** Наконец, применяются к чартам, которые уже содержат данные, отфильтрованные предыдущими уровнями.

### 6. RLS/OLS в Superset

Как и в других BI-системах, Apache Superset также предлагает механизмы безопасности для контроля доступа к данным.

* **RLS (Row-Level Security) — Безопасность на уровне строк:**
    * **Назначение:** Позволяет контролировать, какие **строки** данных видит пользователь в конкретном датасете.
    * **Реализация в Superset:** RLS в Superset реализуется через создание **ролей** и привязку к ним **SQL-фильтров**, которые применяются к датасетам.
    * **Шаги по настройке:**
        1.  **Создать роль:** В `Security -> Roles` создайте новую роль (например, "Менеджер по продажам Севера").
        2.  **Добавить пользователей в роль:** Присвойте нужным пользователям эту роль.
        3.  **Создать фильтр RLS:**
            * Перейдите в `Security -> RLS`.
            * Нажмите `+ RLS Rule`.
            * Укажите `Dataset` (например, "Продажи").
            * Укажите `Role` (например, "Менеджер по продажам Севера").
            * В поле `SQL Predicate` напишите SQL-условие, которое будет применяться к запросу к этому датасету.
                * **Пример:** `region = 'North'` или `sales_person_id = {{ current_user_id() }}` (Superset поддерживает шаблонизацию с `current_user_id()`, `current_username()` для динамических фильтров).
            * **Filter Type:**
                * `Row Level Security`: Фильтр применяется как `WHERE` условие.
                * `Table Access`: Если у пользователя нет разрешений на этот датасет, он не увидит никаких данных.
        4.  Когда пользователь с этой ролью запрашивает данные из датасета "Продажи", Superset автоматически добавляет `WHERE region = 'North'` к SQL-запросу, который отправляется в базу данных.

    * **Пример:** Менеджер Иван из Северного региона видит только продажи по Северу, а менеджер Петр из Южного региона видит только продажи по Югу, используя один и тот же дашборд.

* **OLS (Object-Level Security) — Безопасность на уровне объектов:**
    * **Назначение:** Позволяет контролировать доступ пользователей к **таблицам/датасетам** и **столбцам** в этих датасетах.
    * **Реализация в Superset:** OLS управляется через систему разрешений ролей на уровне базы данных, датасетов и отдельных столбцов.
    * **Шаги по настройке:**
        1.  **Разрешения на базу данных:** В `Security -> Roles` для каждой роли вы можете указать, к каким базам данных она имеет доступ. Если нет доступа к БД, нет доступа и к датасетам в ней.
        2.  **Разрешения на датасеты:** Для каждой роли можно настроить, к каким датасетам она имеет доступ. Если нет доступа к датасету, пользователь не сможет строить чарты на его основе или видеть их на дашбордах.
        3.  **Разрешения на столбцы:** (Эта функциональность может быть более сложной или требовать ручной настройки в некоторых версиях Superset или кастомных плагинах/настройках.) В более простых случаях OLS на уровне столбцов достигается путем создания разных датасетов, которые включают только те столбцы, к которым разрешен доступ определенным группам пользователей, или путем создания представлений (views) в самой базе данных, которые скрывают конфиденциальные столбцы.
            * В некоторых конфигурациях и версиях Superset, в настройках датасета для каждого столбца можно установить флаг `Is PII` (Personally Identifiable Information) или аналогичный, а затем управлять видимостью таких столбцов через роли.

    * **Пример OLS:**
        * Роль "Бухгалтер" имеет доступ к датасету "Данные о зарплате", который включает столбец "Размер зарплаты".
        * Роль "Менеджер отдела" имеет доступ к датасету "Данные о сотрудниках", но этот датасет не содержит столбца "Размер зарплаты", или же OLS настроен так, что для этой роли столбец "Размер зарплаты" скрыт.

**Разница и сочетание:**

* **RLS** управляет *какими строками* вы можете видеть из доступного вам датасета.
* **OLS** управляет *к каким датасетам (и их столбцам)* вы вообще имеете доступ.

Они работают вместе, чтобы обеспечить комплексную безопасность данных в Superset. Сначала OLS определяет, к каким объектам у вас есть доступ, а затем RLS применяет фильтры к строкам внутри этих доступных объектов.

---

Надеюсь, это покрывает все вопросы из вашего второго блока! Удачи на экзамене!

